import{a as e,j as t,b as r,c as a}from"./index-7df8bb8f.js";import{r as s}from"./vendor-83d6deea.js";import{a as d,c as l,u as o}from"./query-c0dd8be7.js";import{h as n,X as i,a8 as c,m as x,ah as u,ac as m,ad as b,e as g}from"./ui-88b07fc3.js";import"./router-225372b8.js";import"./i18n-eaa6a7d3.js";import"./utils-2ffb253a.js";const h=({isOpen:a,onClose:o})=>{const x=d(),{currency:u}=e(),[m,b]=s.useState({type:"handover",amount:0,description:"",date:(new Date).toISOString().split("T")[0]}),[g,h]=s.useState(null),p=l({mutationFn:async e=>(await r.post("/cashflow/record",e,{headers:{"Content-Type":"multipart/form-data"}})).data,onSuccess:()=>{x.invalidateQueries({queryKey:["cashflow"]}),x.invalidateQueries({queryKey:["auditLog"]}),o(),b({type:"handover",amount:0,description:"",date:(new Date).toISOString().split("T")[0]}),h(null)}}),k=e=>{e.preventDefault();const t=new FormData;Object.entries(m).forEach(([e,r])=>{void 0!==r&&""!==r&&t.append(e,r.toString())}),g&&t.append("documentation",g),p.mutate(t)},y=e=>{const{name:t,value:r}=e.target;b(e=>({...e,[t]:r}))};return a?t.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-2xl",children:[t.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[t.jsx(n,{size:24}),"Record Cash Flow"]}),t.jsx("button",{onClick:o,className:"text-gray-500 hover:text-gray-700",children:t.jsx(i,{size:24})})]})}),t.jsxs("form",{onSubmit:k,className:"p-6 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Transaction Type"}),t.jsxs("select",{name:"type",value:m.type,onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[t.jsx("option",{value:"handover",children:"Cash Handover"}),t.jsx("option",{value:"deposit",children:"Bank Deposit"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Amount (",u,")"]}),t.jsx("input",{type:"number",name:"amount",value:m.amount,onChange:y,step:"0.01",min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date"}),t.jsx("input",{type:"date",name:"date",value:m.date,onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),t.jsx("textarea",{name:"description",value:m.description,onChange:y,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Describe the transaction...",required:!0})]}),"deposit"===m.type&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Bank Name"}),t.jsx("input",{type:"text",name:"bankName",value:m.bankName||"",onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Account Number"}),t.jsx("input",{type:"text",name:"accountNumber",value:m.accountNumber||"",onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{className:"col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Transaction ID"}),t.jsx("input",{type:"text",name:"transactionId",value:m.transactionId||"",onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),"handover"===m.type&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Handed Over To"}),t.jsx("input",{type:"text",name:"handedOverTo",value:m.handedOverTo||"",onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Received By"}),t.jsx("input",{type:"text",name:"receivedBy",value:m.receivedBy||"",onChange:y,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Documentation (Receipt/Image)"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("input",{type:"file",onChange:e=>{var t;return h((null==(t=e.target.files)?void 0:t[0])||null)},accept:"image/*,.pdf",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),t.jsx(c,{size:20,className:"text-gray-400"})]})]})]}),t.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[t.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),t.jsx("button",{onClick:k,disabled:p.isLoading,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:p.isLoading?"Recording...":"Record Transaction"})]}),t.jsx("div",{className:"px-6 pb-4 text-xs text-gray-500 text-center",children:"Powered by HNV Property Management Solutions"})]})}):null},p=({isOpen:e,onClose:a,resourceId:o,resourceModel:n,approverId:c,onSuccess:x})=>{d();const[u,m]=s.useState(""),[b,g]=s.useState(""),h=l({mutationFn:e=>r.post("/edit-requests",e),onSuccess:()=>{alert("Your request has been sent to the Landlord for approval."),x(),a()},onError:e=>{var t,r;g((null==(r=null==(t=e.response)?void 0:t.data)?void 0:r.message)||"Failed to send request.")}});return e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 transition-opacity duration-300",children:t.jsxs("div",{className:"bg-light-card dark:bg-dark-card rounded-xl shadow-xl w-full max-w-lg border border-border-color dark:border-border-color-dark transition-all duration-200",children:[t.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-border-color dark:border-border-color-dark",children:[t.jsx("h2",{className:"text-xl font-bold text-dark-text dark:text-dark-text-dark",children:"Request Permission to Edit"}),t.jsx("button",{onClick:a,className:"text-light-text dark:text-light-text-dark hover:text-dark-text dark:hover:text-dark-text-dark transition-colors",children:t.jsx(i,{size:24})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),g(""),u?h.mutate({resourceId:o,resourceModel:n,reason:u,approverId:c}):g("A reason for the request is required.")},className:"p-6 space-y-4",children:[b&&t.jsx("div",{className:"bg-red-100 text-red-700 p-3 rounded-lg text-sm transition-all duration-200",children:b}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Reason for Request"}),t.jsx("textarea",{id:"reason",name:"reason",rows:4,value:u,onChange:e=>m(e.target.value),required:!0,className:"mt-1 w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-border-color dark:border-border-color-dark rounded-md text-dark-text dark:text-dark-text-dark focus:ring-brand-primary focus:border-brand-primary transition-all duration-200",placeholder:`Explain why you need to edit this ${n} record.`})]}),t.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[t.jsx("button",{type:"button",onClick:a,className:"px-5 py-2 bg-light-bg dark:bg-dark-bg text-dark-text dark:text-dark-text-dark font-semibold rounded-lg hover:bg-border-color dark:hover:bg-border-color-dark transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:h.isLoading,className:"px-5 py-2 bg-brand-primary text-white font-semibold rounded-lg hover:bg-brand-secondary disabled:opacity-50 transition-colors duration-200",children:h.isLoading?"Sending Request...":"Send Request"})]})]})]})}):null},k=async()=>{const{data:e}=await r.get("/cashflow");return e.data},y=()=>{var e;const{user:r}=a(),[d,l]=s.useState(!1),[i,c]=s.useState(!1),[y,j]=s.useState(null),{data:f=[],isLoading:v,isError:N,refetch:w}=o({queryKey:["cashFlowRecords"],queryFn:k});return v?t.jsx("div",{className:"text-center p-8 text-dark-text dark:text-dark-text-dark",children:"Loading cash flow records..."}):N?t.jsx("div",{className:"text-center p-8 text-red-400 dark:text-red-400",children:"Failed to fetch cash flow records."}):t.jsxs(x.div,{initial:"initial",animate:"in",exit:"out",variants:{initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}},transition:{duration:.4},className:"text-dark-text dark:text-dark-text-dark",children:[t.jsx(h,{isOpen:d,onClose:()=>l(!1)}),y&&t.jsx(p,{isOpen:i,onClose:()=>c(!1),resourceId:y._id,resourceModel:"CashFlow",approverId:null==(e=y.toUser)?void 0:e._id,onSuccess:()=>w()}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[t.jsx("h1",{className:"text-3xl font-bold text-dark-text dark:text-dark-text-dark",children:"Cash Flow Management"}),"Agent"===(null==r?void 0:r.role)&&t.jsxs("button",{onClick:()=>l(!0),className:"btn-primary flex items-center space-x-2",children:[t.jsx(u,{size:18}),t.jsx("span",{children:"Record Transaction"})]})]}),0===f.length?t.jsxs("div",{className:"text-center py-16 bg-light-card rounded-3xl border-2 border-dashed border-border-color dark:bg-dark-card dark:border-border-color-dark",children:[t.jsx("h3",{className:"text-xl font-semibold text-dark-text dark:text-dark-text-dark",children:"No Cash Flow Records Found"}),t.jsx("p",{className:"text-light-text mt-2 dark:text-light-text-dark",children:"No cash flow transactions have been recorded yet."})]}):t.jsx("div",{className:"bg-light-card rounded-3xl shadow-lg border border-border-color overflow-hidden dark:bg-dark-card dark:border-border-color-dark",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left",children:[t.jsx("thead",{className:"bg-light-bg/50 border-b border-border-color dark:bg-dark-bg/50 dark:border-border-color-dark",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase dark:text-light-text-dark",children:"Date"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase dark:text-light-text-dark",children:"Type"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase dark:text-light-text-dark",children:"From"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase dark:text-light-text-dark",children:"To"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase dark:text-light-text-dark",children:"Amount"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase dark:text-light-text-dark",children:"Status"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase text-right dark:text-light-text-dark",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-border-color dark:divide-border-color-dark",children:f.map(e=>{var a,s,d;return t.jsxs("tr",{className:"hover:bg-light-bg/50 transition-colors duration-150 dark:hover:bg-dark-bg/40",children:[t.jsx("td",{className:"p-4 font-semibold text-dark-text dark:text-dark-text-dark",children:new Date(e.transactionDate).toLocaleDateString()}),t.jsxs("td",{className:"p-4 flex items-center gap-2 text-light-text dark:text-light-text-dark capitalize",children:[(d=e.type,"cash_handover"===d?t.jsx(g,{size:16,className:"text-brand-primary"}):"bank_deposit"===d?t.jsx(n,{size:16,className:"text-brand-teal"}):null)," ",t.jsx("span",{className:"capitalize",children:e.type.replace(/_/g," ")})]}),t.jsx("td",{className:"p-4 text-light-text dark:text-light-text-dark",children:e.fromUser.name}),t.jsx("td",{className:"p-4 text-light-text dark:text-light-text-dark",children:(null==(a=e.toUser)?void 0:a.name)||"Bank"}),t.jsxs("td",{className:"p-4 font-semibold text-dark-text dark:text-dark-text-dark",children:[t.jsx(n,{size:14,className:"inline-block mr-1 text-green-400"}),e.amount.toFixed(2)]}),t.jsx("td",{className:"p-4",children:t.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full capitalize ${s=e.status,{pending:"bg-yellow-500/20 text-yellow-300",completed:"bg-green-500/20 text-green-300"}[s]||"bg-light-text/20 text-light-text"}`,children:e.status})}),t.jsx("td",{className:"p-4 text-right space-x-2",children:"Landlord"===(null==r?void 0:r.role)?t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"text-brand-primary hover:underline p-2 transition-colors duration-150",title:"Edit Record",children:t.jsx(m,{size:16})}),t.jsx("button",{className:"text-red-500 hover:underline p-2 transition-colors duration-150",title:"Delete Record",children:t.jsx(b,{size:16})})]}):"Agent"===(null==r?void 0:r.role)&&e.fromUser._id===(null==r?void 0:r._id)&&t.jsx("button",{onClick:()=>(e=>{j(e),c(!0)})(e),className:"text-brand-secondary hover:underline p-2 transition-colors duration-150",title:"Request Permission to Edit",children:t.jsx(m,{size:16})})})]},e._id)})})]})})})]})};export{y as default};
