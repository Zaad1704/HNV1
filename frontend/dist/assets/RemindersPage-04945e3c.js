import{j as e,b as t}from"./index-7df8bb8f.js";import{r}from"./vendor-83d6deea.js";import{a,u as d,c as s}from"./query-c0dd8be7.js";import{X as n,ah as i,ac as l,ad as o,B as c,V as x,S as m,a7 as u}from"./ui-88b07fc3.js";import"./router-225372b8.js";import"./i18n-eaa6a7d3.js";import"./utils-2ffb253a.js";const b=async()=>{const{data:e}=await t.get("/tenants");return e.data},h=({isOpen:i,onClose:l,onSaveSuccess:o,reminderToEdit:c})=>{a();const x=!!c,[m,u]=r.useState({tenantId:"",type:"email_rent_reminder",message:"",frequency:"monthly",nextRunDate:(new Date).toISOString().split("T")[0],status:"active"}),[h,g]=r.useState(null);r.useEffect(()=>{u(x&&c?{tenantId:"object"==typeof c.tenantId?c.tenantId._id:c.tenantId,type:c.type,message:c.message||"",frequency:c.frequency,nextRunDate:new Date(c.nextRunDate).toISOString().split("T")[0],status:"sent"===c.status||"failed"===c.status?"active":c.status}:{tenantId:"",type:"email_rent_reminder",message:"",frequency:"monthly",nextRunDate:(new Date).toISOString().split("T")[0],status:"active"})},[x,c,i]);const{data:k,isLoading:p}=d({queryKey:["tenantsForReminder"],queryFn:b,enabled:i}),y=s({mutationFn:e=>x?t.put(`/reminders/${null==c?void 0:c._id}`,e):t.post("/reminders",e),onSuccess:()=>{o(),l()},onError:e=>{var t,r;g((null==(r=null==(t=e.response)?void 0:t.data)?void 0:r.message)||`Failed to ${x?"update":"create"} reminder.`)}}),j=e=>{u({...m,[e.target.name]:e.target.value})};return i?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4 transition-opacity duration-300",children:e.jsxs("div",{className:"bg-light-card dark:bg-dark-card rounded-xl shadow-xl w-full max-w-lg border border-border-color dark:border-border-color-dark transition-all duration-200",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-border-color dark:border-border-color-dark",children:[e.jsx("h2",{className:"text-xl font-bold text-dark-text dark:text-dark-text-dark",children:x?"Edit Reminder":"Create New Reminder"}),e.jsx("button",{onClick:l,className:"text-light-text dark:text-light-text-dark hover:text-dark-text dark:hover:text-dark-text-dark transition-colors",children:e.jsx(n,{size:24})})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),g(null),y.mutate(m)},className:"p-6 space-y-4 max-h-[85vh] overflow-y-auto text-light-text dark:text-light-text-dark",children:[h&&e.jsx("div",{className:"bg-red-500/20 text-red-400 p-3 rounded-lg transition-all duration-200",children:h}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tenantId",className:"block text-sm font-medium",children:"Tenant"}),e.jsxs("select",{name:"tenantId",id:"tenantId",value:m.tenantId,onChange:j,className:"mt-1 block w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-border-color dark:border-border-color-dark rounded-md text-dark-text dark:text-dark-text-dark focus:ring-brand-primary focus:border-brand-primary transition-all duration-200",required:!0,disabled:x,children:[e.jsx("option",{value:"",children:p?"Loading...":"Select a Tenant"}),null==k?void 0:k.map(t=>{var r;return e.jsxs("option",{value:t._id,children:[t.name," - Unit ",t.unit," (",null==(r=t.propertyId)?void 0:r.name,")"]},t._id)})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"type",className:"block text-sm font-medium",children:"Reminder Type"}),e.jsxs("select",{name:"type",id:"type",value:m.type,onChange:j,className:"mt-1 block w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-border-color dark:border-border-color-dark rounded-md text-dark-text dark:text-dark-text-dark focus:ring-brand-primary focus:border-brand-primary transition-all duration-200",required:!0,children:[e.jsx("option",{value:"email_rent_reminder",children:"Email Rent Reminder"}),e.jsx("option",{value:"app_rent_reminder",children:"In-App Rent Reminder"}),e.jsx("option",{value:"sms_rent_reminder",children:"SMS Rent Reminder"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"frequency",className:"block text-sm font-medium",children:"Frequency"}),e.jsxs("select",{name:"frequency",id:"frequency",value:m.frequency,onChange:j,className:"mt-1 block w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-border-color dark:border-border-color-dark rounded-md text-dark-text dark:text-dark-text-dark focus:ring-brand-primary focus:border-brand-primary transition-all duration-200",required:!0,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nextRunDate",className:"block text-sm font-medium",children:"Next Send Date"}),e.jsx("input",{type:"date",name:"nextRunDate",id:"nextRunDate",value:m.nextRunDate,onChange:j,className:"mt-1 block w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-border-color dark:border-border-color-dark rounded-md text-dark-text dark:text-dark-text-dark focus:ring-brand-primary focus:border-brand-primary transition-all duration-200",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium",children:"Status"}),e.jsxs("select",{name:"status",id:"status",value:m.status,onChange:j,className:"mt-1 block w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border border-border-color dark:border-border-color-dark rounded-md text-dark-text dark:text-dark-text-dark focus:ring-brand-primary focus:border-brand-primary transition-all duration-200",required:!0,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"message",className:"block text-sm font-medium",children:"Custom Message (Optional)"}),e.jsx("textarea",{name:"message",id:"message",rows:3,value:m.message,onChange:j,className:"mt-1 block w-full px-3 py-2 bg-light-bg dark:bg-dark-bg border-border-color dark:border-border-color-dark rounded-md text-dark-text dark:text-dark-text-dark focus:ring-brand-primary focus:border-brand-primary transition-all duration-200"})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-5 py-2 bg-light-bg dark:bg-dark-bg text-dark-text dark:text-dark-text-dark font-semibold rounded-lg hover:bg-border-color dark:hover:bg-border-color-dark transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:y.isLoading,className:"px-5 py-2 bg-brand-primary text-white font-semibold rounded-lg hover:bg-brand-secondary disabled:opacity-50 transition-colors duration-200",children:y.isLoading?"Saving...":x?"Save Reminder":"Create Reminder"})]})]})]})}):null},g=async()=>{const{data:e}=await t.get("/reminders");return e.data},k=()=>{const n=a(),[b,k]=r.useState(!1),[p,y]=r.useState(void 0),{data:j=[],isLoading:f,isError:v,refetch:N}=d({queryKey:["reminders"],queryFn:g}),w=s({mutationFn:e=>t.delete(`/reminders/${e}`),onSuccess:()=>{n.invalidateQueries({queryKey:["reminders"]}),alert("Reminder deleted successfully!")},onError:e=>{var t,r;alert(`Failed to delete reminder: ${(null==(r=null==(t=e.response)?void 0:t.data)?void 0:r.message)||e.message}`)}});return f?e.jsx("div",{className:"text-center p-8 text-dark-text dark:text-dark-text-dark",children:"Loading reminders..."}):v?e.jsx("div",{className:"text-red-400 text-center p-8 dark:text-red-400",children:"Failed to fetch reminders."}):e.jsxs("div",{className:"text-dark-text dark:text-dark-text-dark",children:[e.jsx(h,{isOpen:b,onClose:()=>k(!1),onSaveSuccess:()=>N(),reminderToEdit:p}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Automated Reminders"}),e.jsxs("button",{onClick:()=>{y(void 0),k(!0)},className:"flex items-center space-x-2 px-4 py-2.5 bg-brand-primary hover:bg-brand-secondary text-white font-bold rounded-lg shadow-md transition-colors duration-200",children:[e.jsx(i,{size:18}),e.jsx("span",{children:"Add New Reminder"})]})]}),0===j.length?e.jsxs("div",{className:"text-center py-16 bg-light-card dark:bg-dark-card rounded-xl border-2 border-dashed border-border-color dark:border-border-color-dark transition-all duration-200",children:[e.jsx("h3",{className:"text-xl font-semibold text-dark-text dark:text-dark-text-dark",children:"No Automated Reminders Configured"}),e.jsx("p",{className:"text-light-text dark:text-light-text-dark mt-2 mb-4",children:"Set up recurring rent reminders for your tenants."})]}):e.jsx("div",{className:"bg-light-card dark:bg-dark-card rounded-xl shadow-lg border border-border-color dark:border-border-color-dark overflow-hidden transition-all duration-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-light-bg dark:bg-dark-bg/50 border-b border-border-color dark:border-border-color-dark",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 text-sm font-semibold text-light-text dark:text-light-text-dark uppercase",children:"Tenant"}),e.jsx("th",{className:"p-4 text-sm font-semibold text-light-text dark:text-light-text-dark uppercase",children:"Type"}),e.jsx("th",{className:"p-4 text-sm font-semibold text-light-text dark:text-light-text-dark uppercase",children:"Next Send"}),e.jsx("th",{className:"p-4 text-sm font-semibold text-light-text dark:text-light-text-dark uppercase",children:"Frequency"}),e.jsx("th",{className:"p-4 text-sm font-semibold text-light-text dark:text-light-text-dark uppercase",children:"Status"}),e.jsx("th",{className:"p-4 text-sm font-semibold text-light-text dark:text-light-text-dark uppercase text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border-color dark:divide-border-color-dark",children:j.map(t=>{return e.jsxs("tr",{className:"hover:bg-light-bg dark:hover:bg-dark-bg/40 transition-colors duration-150",children:[e.jsxs("td",{className:"p-4 font-semibold text-dark-text dark:text-dark-text-dark",children:[t.tenantId.name," (",t.tenantId.unit,")"]}),e.jsxs("td",{className:"p-4 flex items-center gap-2 text-light-text dark:text-light-text-dark capitalize",children:[(a=t.type,{email_rent_reminder:e.jsx(x,{size:16}),app_rent_reminder:e.jsx(m,{size:16}),sms_rent_reminder:e.jsx(u,{size:16})}[a]||e.jsx(c,{size:16}))," ",t.type.replace(/_/g," ")]}),e.jsx("td",{className:"p-4 text-light-text dark:text-light-text-dark",children:new Date(t.nextRunDate).toLocaleDateString()}),e.jsx("td",{className:"p-4 text-light-text dark:text-light-text-dark capitalize",children:t.frequency}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full capitalize ${r=t.status,{active:"bg-green-500/20 text-green-300",inactive:"bg-gray-500/20 text-gray-300",sent:"bg-blue-500/20 text-blue-300",failed:"bg-red-500/20 text-red-400"}[r]||"bg-gray-500/20 text-gray-300"}`,children:t.status})}),e.jsxs("td",{className:"p-4 text-right space-x-2",children:[e.jsx("button",{onClick:()=>(e=>{y(e),k(!0)})(t),className:"text-brand-primary dark:text-brand-secondary hover:underline p-2 transition-colors duration-150",title:"Edit Reminder",children:e.jsx(l,{size:16})}),e.jsx("button",{onClick:()=>{return e=t._id,void(window.confirm("Are you sure you want to delete this reminder?")&&w.mutate(e));var e},className:"text-red-400 hover:underline p-2 transition-colors duration-150",title:"Delete Reminder",disabled:w.isLoading,children:e.jsx(o,{size:16})})]})]},t._id);var r,a})})]})})})]})};export{k as default};
