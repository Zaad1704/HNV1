import{j as e,b as t}from"./index-7df8bb8f.js";import{r as a}from"./vendor-83d6deea.js";import{c as r,a as d,L as s}from"./router-225372b8.js";import{a as n,c as l,u as o}from"./query-c0dd8be7.js";import{X as i,ak as c,ac as x,D as m,ad as b,V as h,P as u,H as p,F as k}from"./ui-88b07fc3.js";import"./i18n-eaa6a7d3.js";import"./utils-2ffb253a.js";const g=({isOpen:r,onClose:d,tenant:s,onTenantUpdated:o})=>{const c=n(),[x,m]=a.useState({}),[b,h]=a.useState("");a.useEffect(()=>{s&&m({name:s.name||"",email:s.email||"",phone:s.phone||"",unit:s.unit||"",status:s.status||"Active",fatherName:s.fatherName||"",motherName:s.motherName||"",permanentAddress:s.permanentAddress||"",govtIdNumber:s.govtIdNumber||""})},[s,r]);const u=l({mutationFn:e=>t.put(`/tenants/${s._id}`,e),onSuccess:()=>{c.invalidateQueries({queryKey:["tenants"]}),c.invalidateQueries({queryKey:["tenantDetails",s._id]}),o(),d()},onError:e=>{var t,a;return h((null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.message)||"Failed to update tenant.")}}),p=e=>{m({...x,[e.target.name]:e.target.value})};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-light-card dark:bg-dark-card rounded-3xl shadow-xl w-full max-w-3xl border border-border-color dark:border-border-color-dark",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-border-color dark:border-border-color-dark",children:[e.jsxs("h2",{className:"text-xl font-bold text-dark-text dark:text-dark-text-dark",children:["Edit Tenant: ",null==s?void 0:s.name]}),e.jsx("button",{onClick:d,className:"text-light-text dark:text-light-text-dark hover:text-dark-text dark:hover:text-dark-text-dark transition-colors",children:e.jsx(i,{size:24})})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=new FormData;for(const a in x)t.append(a,x[a]);u.mutate(t)},className:"p-6 space-y-4 max-h-[85vh] overflow-y-auto text-light-text dark:text-light-text-dark",children:[b&&e.jsx("div",{className:"bg-red-500/10 text-red-500 p-3 rounded-lg",children:b}),e.jsx("h3",{className:"text-lg font-semibold text-dark-text dark:text-dark-text-dark",children:"Tenant Info"}),e.jsxs("div",{children:[e.jsx("label",{children:"Full Name*"}),e.jsx("input",{type:"text",name:"name",required:!0,value:x.name||"",onChange:p})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Email*"}),e.jsx("input",{type:"email",name:"email",required:!0,value:x.email||"",onChange:p})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{name:"status",value:x.status||"Active",onChange:p,children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"}),e.jsx("option",{value:"Late",children:"Late"})]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:x.phone||"",onChange:p})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t border-border-color dark:border-border-color-dark mt-4",children:[e.jsx("button",{type:"button",onClick:d,className:"btn-light",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u.isLoading,className:"btn-primary",children:u.isLoading?"Saving...":"Save Changes"})]})]})]})}):null},j=()=>{var i;const{tenantId:j}=r(),v=n(),f=d(),[y,N]=a.useState(!1),{data:w,isLoading:C,isError:D}=o({queryKey:["tenantDetails",j],queryFn:()=>(async e=>{const{data:a}=await t.get(`/tenants/${e}`);return a.data})(j),enabled:!!j}),L=l({mutationFn:e=>t.delete(`/tenants/${e}`),onSuccess:()=>{v.invalidateQueries({queryKey:["tenants"]}),f("/dashboard/tenants")}});return C?e.jsx("div",{className:"p-8 text-center text-dark-text dark:text-dark-text-dark",children:"Loading Tenant Profile..."}):D?e.jsx("div",{className:"p-8 text-center text-red-500 dark:text-red-500",children:"Error loading tenant details."}):e.jsxs("div",{className:"text-dark-text dark:text-dark-text-dark",children:[e.jsx(g,{isOpen:y,onClose:()=>N(!1),tenant:w,onTenantUpdated:()=>{v.invalidateQueries({queryKey:["tenantDetails",j]})}}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(s,{to:"/dashboard/tenants",className:"text-light-text dark:text-light-text-dark hover:text-brand-primary dark:hover:text-brand-secondary transition-colors duration-150",title:"Back to Tenants List",children:e.jsx(c,{size:24})}),e.jsx("h1",{className:"text-3xl font-bold",children:"Tenant Profile"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-light-card dark:bg-dark-card border border-border-color dark:border-border-color-dark rounded-lg hover:bg-light-bg dark:hover:bg-dark-bg/40 font-semibold text-dark-text dark:text-dark-text-dark transition-colors",children:[e.jsx(x,{size:16})," Edit Profile"]}),e.jsxs("button",{onClick:async()=>{var e;try{const a=await t.get(`/reports/tenants/export?tenantId=${j}&format=pdf`,{responseType:"blob"}),r=window.URL.createObjectURL(new Blob([a.data])),d=document.createElement("a");d.href=r,d.setAttribute("download",`tenant-${j}.pdf`),document.body.appendChild(d),d.click(),null==(e=d.parentNode)||e.removeChild(d)}catch(a){alert("Could not download tenant PDF.")}},className:"flex items-center gap-2 px-4 py-2 bg-light-card dark:bg-dark-card border border-border-color dark:border-border-color-dark rounded-lg hover:bg-light-bg dark:hover:bg-dark-bg/40 text-dark-text dark:text-dark-text-dark transition-colors",children:[e.jsx(m,{size:16})," Download PDF"]}),e.jsxs("button",{onClick:()=>{window.confirm("Are you sure you want to delete this tenant?")&&L.mutate(j)},disabled:L.isLoading,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(b,{size:16})," Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"bg-light-card dark:bg-dark-card p-6 rounded-xl border border-border-color dark:border-border-color-dark shadow-sm transition-all duration-200",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:null==w?void 0:w.name}),e.jsxs("p",{className:"flex items-center gap-2 text-light-text dark:text-light-text-dark",children:[e.jsx(h,{size:16,className:"text-brand-primary dark:text-brand-secondary"})," ",null==w?void 0:w.email]}),e.jsxs("p",{className:"flex items-center gap-2 text-light-text dark:text-light-text-dark",children:[e.jsx(u,{size:16,className:"text-brand-primary dark:text-brand-secondary"})," ",null==w?void 0:w.phone]})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"bg-light-card dark:bg-dark-card p-6 rounded-xl border border-border-color dark:border-border-color-dark shadow-sm transition-all duration-200",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Lease Information"}),e.jsxs("p",{className:"flex items-center gap-2 text-light-text dark:text-light-text-dark",children:[e.jsx(p,{size:16,className:"text-brand-primary dark:text-brand-secondary"})," Property: ",null==(i=null==w?void 0:w.propertyId)?void 0:i.name]}),e.jsxs("p",{className:"flex items-center gap-2 text-light-text dark:text-light-text-dark",children:[e.jsx(k,{size:16,className:"text-brand-primary dark:text-brand-secondary"})," Lease End Date: ",(null==w?void 0:w.leaseEndDate)?new Date(w.leaseEndDate).toLocaleDateString():"N/A"]})]})})]})]})};export{j as default};
