import{j as t,b as e}from"./index-7df8bb8f.js";import{r as a,a as r}from"./vendor-83d6deea.js";import{a as d,u as n,c as s}from"./query-c0dd8be7.js";import{m as l,ah as i,D as o}from"./ui-88b07fc3.js";import"./router-225372b8.js";import"./i18n-eaa6a7d3.js";import"./utils-2ffb253a.js";const c=async()=>{const{data:t}=await e.get("/tenants");return t.data},x=async t=>{const{data:a}=await e.post("/payments",t);return a.data},m=({isOpen:e,onClose:l})=>{const i=d(),[o,m]=a.useState({tenantId:"",amount:"",paymentDate:(new Date).toISOString().split("T")[0],lineItems:[],paidForMonth:(new Date).toISOString().split("T")[0].substring(0,7),totalCalculatedAmount:0}),[h,u]=a.useState(""),{data:p,isLoading:b}=n({queryKey:["tenantsForPayment"],queryFn:c,enabled:e});r.useEffect(()=>{const t=o.lineItems.reduce((t,e)=>t+(e.amount||0),0);m(e=>({...e,totalCalculatedAmount:t}))},[o.lineItems]);const g=s({mutationFn:x,onSuccess:()=>{i.invalidateQueries({queryKey:["payments"]}),l()},onError:t=>{var e,a;u((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||"Failed to record payment.")}}),k=t=>{m({...o,[t.target.name]:t.target.value})};return e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:t.jsxs("div",{className:"bg-light-card dark:bg-dark-card rounded-3xl shadow-xl w-full max-w-lg border border-border-color dark:border-border-color-dark",children:[t.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-border-color dark:border-border-color-dark",children:[t.jsx("h2",{className:"text-xl font-bold text-dark-text dark:text-dark-text-dark",children:"Record Manual Payment"}),t.jsx("button",{onClick:l,className:"text-light-text dark:text-light-text-dark hover:text-dark-text dark:hover:text-dark-text-dark text-2xl",children:"Ã—"})]}),t.jsxs("form",{onSubmit:t=>{t.preventDefault(),u("");const e=o.lineItems.length>0?o.totalCalculatedAmount:Number(o.amount);if(!e||e<=0)return void u("Please enter a valid amount or breakdown.");const a={tenantId:o.tenantId,amount:e,paymentDate:o.paymentDate,status:"Paid",lineItems:o.lineItems.filter(t=>t.description&&t.amount>0),paidForMonth:o.paidForMonth?`${o.paidForMonth}-01`:void 0};g.mutate(a)},className:"p-6 space-y-4 max-h-[85vh] overflow-y-auto",children:[h&&t.jsx("div",{className:"bg-red-500/10 text-red-500 p-3 rounded-lg",children:h}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"tenantId",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Tenant"}),t.jsxs("select",{name:"tenantId",id:"tenantId",required:!0,value:o.tenantId,onChange:k,disabled:b,children:[t.jsx("option",{value:"",children:b?"Loading...":"Select a Tenant"}),null==p?void 0:p.map(e=>t.jsx("option",{value:e._id,children:e.name},e._id))]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Total Amount ($)"}),t.jsx("input",{type:"number",step:"0.01",name:"amount",id:"amount",required:!0,value:o.lineItems.length>0?o.totalCalculatedAmount.toFixed(2):o.amount,onChange:k,disabled:o.lineItems.length>0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"paymentDate",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Payment Date"}),t.jsx("input",{type:"date",name:"paymentDate",id:"paymentDate",required:!0,value:o.paymentDate,onChange:k})]})]}),t.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[t.jsx("button",{type:"button",onClick:l,className:"btn-light",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:g.isLoading,className:"btn-primary",children:g.isLoading?"Saving...":"Save Payment"})]})]})]})}):null},h=async()=>{const{data:t}=await e.get("/payments");return t.data},u=()=>{const[r,d]=a.useState(!1),{data:s=[],isLoading:c,isError:x}=n({queryKey:["payments"],queryFn:h}),[u,p]=a.useState(null);return c?t.jsx("div",{className:"text-dark-text text-center p-8",children:"Loading..."}):x?t.jsx("div",{className:"text-red-400 text-center p-8",children:"Error loading payments."}):t.jsxs(l.div,{initial:"initial",animate:"in",exit:"out",variants:{initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}},transition:{duration:.4},className:"text-dark-text dark:text-dark-text-dark",children:[t.jsx(m,{isOpen:r,onClose:()=>d(!1)}),t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Payment History"}),t.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center gap-2",children:[t.jsx(i,{size:18}),"Record Manual Payment"]})]}),t.jsx("div",{className:"bg-light-card rounded-3xl shadow-lg border border-border-color overflow-hidden dark:bg-dark-card dark:border-border-color-dark",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left",children:[t.jsx("thead",{className:"bg-light-bg/50 border-b border-border-color dark:bg-dark-bg/50 dark:border-border-color-dark",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-4 uppercase text-sm font-semibold text-light-text dark:text-light-text-dark",children:"Transaction ID"}),t.jsx("th",{className:"p-4 uppercase text-sm font-semibold text-light-text dark:text-light-text-dark",children:"Tenant"}),t.jsx("th",{className:"p-4 uppercase text-sm font-semibold text-light-text dark:text-light-text-dark",children:"Property"}),t.jsx("th",{className:"p-4 uppercase text-sm font-semibold text-light-text dark:text-light-text-dark",children:"Amount"}),t.jsx("th",{className:"p-4 uppercase text-sm font-semibold text-light-text dark:text-light-text-dark",children:"Date"}),t.jsx("th",{className:"p-4 uppercase text-sm font-semibold text-light-text dark:text-light-text-dark",children:"Status"}),t.jsx("th",{className:"p-4 uppercase text-sm font-semibold text-light-text text-right dark:text-light-text-dark",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-border-color dark:divide-border-color-dark",children:s.map(a=>{var r,d,n,s;return t.jsxs("tr",{className:"hover:bg-light-bg/50 dark:hover:bg-dark-bg/40",children:[t.jsx("td",{className:"p-4 text-light-text dark:text-light-text-dark font-mono text-xs",children:a.transactionId||a._id}),t.jsx("td",{className:"p-4 font-bold text-dark-text dark:text-dark-text-dark",children:(null==(r=a.tenantId)?void 0:r.name)||"N/A"}),t.jsx("td",{className:"p-4 text-light-text dark:text-light-text-dark",children:(null==(d=a.propertyId)?void 0:d.name)||"N/A"}),t.jsxs("td",{className:"p-4 text-dark-text font-semibold dark:text-dark-text-dark",children:["$",a.amount.toFixed(2)]}),t.jsx("td",{className:"p-4 text-light-text dark:text-light-text-dark",children:(s=a.paymentDate,new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))}),t.jsx("td",{className:"p-4",children:t.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${n=a.status,{Paid:"bg-green-500/20 text-green-300",Pending:"bg-yellow-500/20 text-yellow-300",Failed:"bg-red-500/20 text-red-400"}[n]||"bg-gray-500/20 text-gray-300"}`,children:a.status})}),t.jsx("td",{className:"p-4 text-right",children:t.jsx("button",{onClick:()=>(async t=>{var a;p(t);try{const r=await e.get(`/receipts/payment/${t}`,{responseType:"blob"}),d=window.URL.createObjectURL(new Blob([r.data])),n=document.createElement("a");n.href=d,n.setAttribute("download",`Receipt-${t}.pdf`),document.body.appendChild(n),n.click(),null==(a=n.parentNode)||a.removeChild(n),window.URL.revokeObjectURL(d)}catch(r){alert("Could not download receipt.")}finally{p(null)}})(a._id),disabled:u===a._id,className:"font-medium text-brand-primary hover:text-brand-secondary flex items-center gap-1 ml-auto disabled:opacity-50",title:"Download PDF Receipt",children:u===a._id?"...":t.jsx(o,{size:16})})})]},a._id)})})]})})})]})};export{u as default};
