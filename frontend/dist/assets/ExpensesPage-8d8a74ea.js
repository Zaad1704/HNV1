import{c as e,j as t,b as a}from"./index-7df8bb8f.js";import{r}from"./vendor-83d6deea.js";import{a as s,u as d,c as i}from"./query-c0dd8be7.js";import{ai as l,m as n,ah as o,ac as x,ad as c}from"./ui-88b07fc3.js";import"./router-225372b8.js";import"./i18n-eaa6a7d3.js";import"./utils-2ffb253a.js";const m=async()=>{const{data:e}=await a.get("/users/my-agents");return e.data},h=async()=>{const{data:e}=await a.get("/properties");return e.data},p=async e=>{const{data:t}=await a.post("/expenses",e);return t.data},u=({isOpen:a,onClose:n})=>{const{user:o}=e(),x=s(),[c,u]=r.useState({description:"",amount:"",category:"Repairs",date:(new Date).toISOString().split("T")[0],propertyId:"",paidToAgentId:""}),[g,b]=r.useState(null),[k,j]=r.useState(""),y="Salary"===c.category,{data:v,isLoading:f}=d({queryKey:["propertiesForExpense"],queryFn:h,enabled:a}),{data:N,isLoading:w}=d({queryKey:["managedAgentsForExpense"],queryFn:m,enabled:a&&"Landlord"===(null==o?void 0:o.role)}),S=i({mutationFn:p,onSuccess:()=>{x.invalidateQueries({queryKey:["expenses"]}),x.invalidateQueries({queryKey:["financialSummary"]}),n()},onError:e=>{var t,a;return j((null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.message)||"Failed to log expense.")}}),F=e=>{u({...c,[e.target.name]:e.target.value})};return a?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:t.jsxs("div",{className:"bg-light-card dark:bg-dark-card rounded-3xl shadow-xl w-full max-w-lg border border-border-color dark:border-border-color-dark",children:[t.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-border-color dark:border-border-color-dark",children:[t.jsx("h2",{className:"text-xl font-bold text-dark-text dark:text-dark-text-dark",children:"Log New Expense"}),t.jsx("button",{onClick:n,className:"text-light-text dark:text-light-text-dark hover:text-dark-text dark:hover:text-dark-text-dark text-2xl",children:"Ã—"})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),j("");const t=new FormData;Object.entries(c).forEach(([e,a])=>t.append(e,a)),g&&t.append("document",g),S.mutate(t)},className:"p-6 space-y-4 max-h-[85vh] overflow-y-auto",children:[k&&t.jsx("div",{className:"bg-red-500/10 text-red-500 p-3 rounded-lg",children:k}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Description"}),t.jsx("input",{type:"text",name:"description",id:"description",required:!0,value:c.description,onChange:F})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Amount ($)"}),t.jsx("input",{type:"number",step:"0.01",name:"amount",id:"amount",required:!0,value:c.amount,onChange:F})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Date"}),t.jsx("input",{type:"date",name:"date",id:"date",required:!0,value:c.date,onChange:F})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Category"}),t.jsxs("select",{name:"category",id:"category",required:!0,value:c.category,onChange:F,children:[t.jsx("option",{children:"Repairs"})," ",t.jsx("option",{children:"Utilities"})," ",t.jsx("option",{children:"Management Fees"}),t.jsx("option",{children:"Insurance"})," ",t.jsx("option",{children:"Taxes"})," ",t.jsx("option",{value:"Salary",children:"Salary"})," ",t.jsx("option",{children:"Other"})]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"propertyId",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Property"}),t.jsxs("select",{name:"propertyId",id:"propertyId",required:!0,value:c.propertyId,onChange:F,disabled:f,children:[t.jsx("option",{value:"",children:f?"Loading...":"Select Property"}),null==v?void 0:v.map(e=>t.jsx("option",{value:e._id,children:e.name},e._id))]})]})]}),y&&"Landlord"===(null==o?void 0:o.role)&&t.jsxs("div",{children:[t.jsx("label",{htmlFor:"paidToAgentId",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Paid To Agent"}),t.jsxs("select",{name:"paidToAgentId",id:"paidToAgentId",value:c.paidToAgentId,onChange:F,disabled:w,children:[t.jsx("option",{value:"",children:w?"Loading Agents...":"Select Agent (Optional)"}),null==N?void 0:N.map(e=>t.jsx("option",{value:e._id,children:e.name},e._id))]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"document",className:"block text-sm font-medium text-light-text dark:text-light-text-dark",children:"Attach Document (Optional)"}),t.jsx("input",{type:"file",name:"document",id:"document",onChange:e=>{e.target.files&&e.target.files[0]?b(e.target.files[0]):b(null)},className:"mt-1 block w-full text-sm"})]}),t.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[t.jsx("button",{type:"button",onClick:n,className:"btn-light",children:"Cancel"}),t.jsxs("button",{type:"submit",disabled:S.isLoading,className:"btn-primary flex items-center justify-center gap-2",children:[t.jsx(l,{size:16})," ",S.isLoading?"Saving...":"Save Expense"]})]})]})]})}):null},g=()=>{const e=s(),[l,m]=r.useState(!1),[h]=r.useState({propertyId:"",startDate:"",endDate:""}),{data:p=[],isLoading:g,isError:b}=d({queryKey:["expenses",h],queryFn:()=>(async e=>{const{data:t}=await a.get("/expenses",{params:e});return t.data})(h)}),k=i({mutationFn:e=>a.delete(`/expenses/${e}`),onSuccess:()=>e.invalidateQueries({queryKey:["expenses"]}),onError:e=>{var t,a;return alert((null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.message)||"Delete failed.")}});return t.jsxs(n.div,{initial:"initial",animate:"in",exit:"out",variants:{initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}},transition:{duration:.4},className:"text-dark-text dark:text-dark-text-dark",children:[t.jsx(u,{isOpen:l,onClose:()=>m(!1)}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[t.jsx("h1",{className:"text-3xl font-bold text-dark-text dark:text-dark-text-dark",children:"Manage Expenses"}),t.jsxs("button",{onClick:()=>m(!0),className:"btn-primary flex items-center space-x-2",children:[t.jsx(o,{size:18}),t.jsx("span",{children:"Log Expense"})]})]}),g?t.jsx("div",{className:"text-center p-8 text-dark-text dark:text-dark-text-dark",children:"Loading expenses..."}):t.jsx("div",{className:"bg-light-card rounded-3xl shadow-lg border border-border-color overflow-hidden dark:bg-dark-card dark:border-border-color-dark",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left",children:[t.jsx("thead",{className:"bg-light-bg/50 border-b border-border-color dark:bg-dark-bg/50 dark:border-border-color-dark",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase dark:text-light-text-dark",children:"Description"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase dark:text-light-text-dark",children:"Property"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase dark:text-light-text-dark",children:"Date"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase dark:text-light-text-dark",children:"Category"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase text-right dark:text-light-text-dark",children:"Amount"}),t.jsx("th",{className:"p-4 text-sm font-semibold text-light-text uppercase text-right dark:text-light-text-dark",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-border-color dark:divide-border-color-dark",children:p.map(e=>{var a,r;return t.jsxs("tr",{className:"hover:bg-light-bg/50 dark:hover:bg-dark-bg/40",children:[t.jsx("td",{className:"p-4 font-semibold text-dark-text dark:text-dark-text-dark",children:e.description}),t.jsx("td",{className:"p-4 text-light-text dark:text-light-text-dark",children:(null==(a=e.propertyId)?void 0:a.name)||"N/A"}),t.jsx("td",{className:"p-4 text-light-text dark:text-light-text-dark",children:(r=e.date,new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))}),t.jsx("td",{className:"p-4 text-light-text dark:text-light-text-dark",children:e.category}),t.jsxs("td",{className:"p-4 text-right font-semibold text-red-500",children:["-$",e.amount.toFixed(2)]}),t.jsx("td",{className:"p-4 text-right",children:t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{className:"p-2 text-light-text dark:text-light-text-dark hover:bg-light-bg dark:hover:bg-dark-bg rounded-md",title:"Edit Expense",children:t.jsx(x,{size:16})}),t.jsx("button",{onClick:()=>k.mutate(e._id),className:"p-2 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/20 rounded-md",title:"Delete Expense",children:t.jsx(c,{size:16})})]})})]},e._id)})})]})})})]})};export{g as default};
